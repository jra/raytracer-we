rt â† â€¢Import "raytracer.bqn"

# image
aspect_ratio â† 16 Ã· 9
image_width â† 400
image_height â† âŒŠ image_width Ã· aspect_ratio

# camera
viewport_height â† 2
viewport_width â† aspect_ratio Ã— viewport_height
focal_length â† 1

origin â† 0â€¿0â€¿0
horizontal â† viewport_widthâ€¿0â€¿0
vertical â† 0â€¿viewport_heightâ€¿0
lower_left_corner â† origin + (-horizontal Ã· 2) + (-vertical Ã· 2) + -0â€¿0â€¿focal_length

# render
im â† âŒ½â‰1 > (âŒ½(â†•Ã·-âŸœ1) image_height) (0âŠ¸âˆ¾â‹ˆ)âŒœ ((â†•Ã·-âŸœ1) image_width)
vp â† {-âŸœorigin lower_left_corner + viewport_widthâ€¿viewport_heightâ€¿1 Ã— ğ•©} â‰1 im

#Dot â† {
#  1â‰¡âŠ‘â‰ ğ•¨? â‰+Â´ (â¥Šğ•¨) Ã— <Ë˜ ğ•©;
#  1â‰¡1âŠ‘â‰¢ğ•©? (â‰ ğ•¨)â€¿1â¥Š (+Â´(â¥Šğ•©)âŠ¸Ã—)Ë˜ğ•¨;
#  ğ•¨ +Ëâˆ˜Ã—â‰1â€¿âˆ ğ•©
#}

Dot â† {
  1â‰¡âŠ‘â‰ ğ•¨? â‰+Â´ (â¥Šğ•¨) Ã— <Ë˜ ğ•©;
  1â‰¡1âŠ‘â‰¢ğ•©? (â‰ ğ•¨)â€¿1â¥Š (+Â´(â¥Šğ•©)âŠ¸Ã—)Ë˜ğ•¨;
  ğ•¨ +Ëâˆ˜Ã—â‰1â€¿âˆ ğ•©
}

DotVV â† {
  ğ•¨ +Ëâˆ˜Ã—â‰1â€¿âˆ ğ•©
}

HitSphere â† {
  centerâ€¿radiusâ€¿r:
  origin â† 3â†‘r
  direction â† 3â†“r
  oc â† origin - center
  a â† âŠ‘ direction DotVV direction
  b â† âŠ‘ 2 Ã— oc DotVV direction
  c â† (âŠ‘ oc DotVV oc) - radius Ã— radius
  discriminant â† (b Ã— b) - 4 Ã— a Ã— c
  #â€¢Out (â€¢Repr oc)âˆ¾", "âˆ¾(â€¢Repr a)âˆ¾", "âˆ¾(â€¢Repr b)âˆ¾", "âˆ¾(â€¢Repr c)âˆ¾", "âˆ¾(â€¢Repr discriminant)
  (discriminant < 0) â—¶ âŸ¨((-b) - âˆšdiscriminant) Ã· 2 Ã— a, Â¯1âŸ© @
}

RayAt â† {
  r ğ•Š t:
  origin â† 3â†‘r
  direction â† 3â†“r
  origin + direction Ã— t
}

ColorRay â† {
  ğ•Š r:
  t â† HitSphere âŸ¨0, 0, Â¯1âŸ©â€¿0.5â€¿r
  (t > 0) â—¶ âŸ¨
    {ğ•¤
      t â† 0.5 Ã— 1 + 1âŠ‘ rt.Unit r
      c â† (1â€¿1â€¿1 Ã— 1 - t) + 0.5â€¿0.7â€¿1.0 Ã— t
      c
    }
    {ğ•¤
      n â† rt.Unit (r RayAt t) - 0â€¿0â€¿Â¯1
      c â† 0.5 Ã— n + 1
      c
    }
  âŸ© @
}

rs â† originâŠ¸âˆ¾ â‰1 vp
cs â† ColorRayâ‰1 rs

"blue.ppm" rt.WritePPM cs
