rt â† â€¢Import "raytracer.bqn"

# image
aspect_ratio â† 16 Ã· 9
image_width â† 400
image_height â† âŒŠ image_width Ã· aspect_ratio
#samples_per_pixel â† 100
samples_per_pixel â† 3

# world
world â† {
  spheres â‡ âŸ¨
    âŸ¨0â€¿0â€¿Â¯1, 0.5âŸ©
    âŸ¨0â€¿Â¯100.5â€¿Â¯1, 100âŸ©
  âŸ©
}

# camera
viewport_height â† 2
viewport_width â† aspect_ratio Ã— viewport_height
focal_length â† 1

origin â† 0â€¿0â€¿0
horizontal â† viewport_widthâ€¿0â€¿0
vertical â† 0â€¿viewport_heightâ€¿0
lower_left_corner â† origin + (-horizontal Ã· 2) + (-vertical Ã· 2) + -0â€¿0â€¿focal_length

GetRay â† {
  ğ•Š uv:
  originâˆ¾{-âŸœorigin lower_left_corner + viewport_widthâ€¿viewport_heightâ€¿1 Ã— uvâˆ¾0}
}

# render
ijs â† > (âŒ½â†•image_height) (âŒ½â‹ˆ)âŒœ (â†•image_width)
â€¢Show â‰¢ ijs
rng â† â€¢MakeRand 0
uvs â† âŸ¨image_width - 1, image_height - 1âŸ© Ã·Ëœâ‰1 ijs +â‰1 image_heightâ€¿image_widthâ€¿samples_per_pixelâ€¿2 rng.Range 0
â€¢Show â‰¢ uvs

rs â† GetRay â‰1 uvs
â€¢Show â‰¢ rs

ColorRay â† {
  world ğ•Š r:
  hitâ€¿rec â† rt.WorldHit worldâ€¿râ€¿0â€¿âˆ
  hit â—¶ âŸ¨
    {ğ•¤
      originâ€¿direction â† (3âŠ¸â†‘â‹ˆ3âŠ¸â†“) r
      t â† 0.5 Ã— 1 + 1âŠ‘ rt.Unit direction
      c â† (1â€¿1â€¿1 Ã— 1 - t) + 0.5â€¿0.7â€¿1.0 Ã— t
      c
    }
    {ğ•¤
      #â€¢Show rec.normal
      c â† 0.5 Ã— rec.normal + 1
      c
    }
  âŸ© @
}

cs â† worldâŠ¸ColorRay â‰1 rs
â€¢Show â‰¢ cs
cs â†© (+ËÃ·â‰ )â‰2 cs
â€¢Show â‰¢ cs

"blue.ppm" rt.WritePPM cs
